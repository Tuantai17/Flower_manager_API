# GIẢI THÍCH CHI TIẾT VỀ HATEOAS (1 ĐIỂM)

**Tài liệu hỗ trợ thuyết trình phần REST API nâng cao**

---

## 1. Khái niệm HATEOAS là gì?

**HATEOAS** viết tắt của _Hypermedia as the Engine of Application State_.

- **Định nghĩa đơn giản**: Khi API trả về dữ liệu cho Client (Frontend/Mobile), nó không chỉ trả về thông tin (ví dụ: tên, giá) mà còn trả kèm **các đường dẫn (Links)** để gợi ý những hành động tiếp theo có thể thực hiện trên dữ liệu đó.
- **Ví dụ đời thực**: Giống như khi bạn lướt web, bạn xem trang chi tiết sản phẩm thì sẽ có các nút (link) để "Mua hàng", "Xem danh mục", "Quay lại". API cũng nên trả về các link như vậy.

---

## 2. File Code và Cách Cài Đặt

**File code chính**: `src/main/java/com/flower/manager/controller/product/ProductController.java`

Dự án sử dụng thư viện **Spring HATEOAS** để tạo link động thay vì nối chuỗi thủ công.

### Chi tiết hàm `addLinks`:

Đây là hàm helper được viết trong Controller để gắn link vào đối tượng `ProductDTO` trước khi trả về.

```java
private ProductDTO addLinks(ProductDTO product) {
    // 1. Tạo Link "self" (Link đến chính nó)
    // methodOn...: Trỏ đến hàm getById trong controller
    // withSelfRel(): Đặt tên cho link là "self" (tiêu chuẩn REST)
    product.add(linkTo(methodOn(ProductController.class).getById(product.getId())).withSelfRel());

    // 2. Tạo Link "by-slug" (Link tìm theo slug)
    product.add(linkTo(methodOn(ProductController.class).getBySlug(product.getSlug())).withRel("by-slug"));

    // 3. Tạo Link "category" (Link đến danh mục của sản phẩm này)
    if (product.getCategoryId() != null) {
        product.add(linkTo(methodOn(ProductController.class).getByCategory(product.getCategoryId()))
                .withRel("category"));
    }
    return product;
}
```

### Cách sử dụng trong API Endpoint:

Khi lấy danh sách sản phẩm, chúng ta gọi hàm `addLinks` cho từng phần tử.

```java
@GetMapping
public ResponseEntity<ApiResponse<List<ProductDTO>>> getAll() {
    List<ProductDTO> products = productService.getAllActive().stream()
            .map(this::addLinks) // Gọi hàm addLinks ở trên cho từng sản phẩm
            .collect(Collectors.toList());
    return ResponseEntity.ok(ApiResponse.success(products));
}
```

---

## 3. Kết quả dữ liệu (JSON Response)

Khi gọi API `GET /api/products/1`, kết quả trả về sẽ có thêm trường `_links`:

```json
{
  "id": 1,
  "name": "Bó Hoa Hồng Đỏ",
  "price": 500000,
  "slug": "bo-hoa-hong-do",
  "_links": {
    "self": {
      "href": "http://localhost:8080/api/products/1"
    },
    "by-slug": {
      "href": "http://localhost:8080/api/products/slug/bo-hoa-hong-do"
    },
    "category": {
      "href": "http://localhost:8080/api/products/category/1"
    }
  }
}
```

### Tại sao điều này "ăn điểm"?

1.  **Chuẩn RESTful**: Đáp ứng ràng buộc cao nhất của kiến trúc REST.
2.  **Linh hoạt**: Nếu sau này bạn đổi đường dẫn API (ví dụ từ `/api/products` thành `/api/v1/products`), Client không cần sửa code vì Client chỉ đọc URL từ trường `_links`.
